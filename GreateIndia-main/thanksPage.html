<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Meta tags to prevent caching -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="0">
    <title>Thanks Page</title>
    
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="productList.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="thanksPage.css"> <!-- Link to your CSS file -->
  
</head>
<body>
    <header>
        <div id="nav"> 
            <div class="logoSearch">      
            <div class="logo">
                <a href="homepage.html">
                    <div class="logoContainer">
                      <img id="bx" src="images/logofirst.png " alt="logo">
                      <img id="bxxx" src="images/logo2.png " alt="logo">
                   </div>
                </a>
            </div>
            <div class="search-container">
                <input type="text" placeholder="search products..." id="searchInput">
                <a href="#" id="searchIcon"><i class="fas fa-search iconSearch"></i></a>
            </div>
        </div>
            <div class="navSubContainer">
           
            <ul class="nav-icons">
                <li>
                    <a href="profile.html" >
                        <div class="iconColumn">
                            <i class="fas fa-user iconCss"></i>
                            <p>Profile</p>
                        </div>
                        
                    </a>
                </li>
                <li>
                    <a href="cart.html">
                        <div class="cart-container">
                            <div class="iconColumn">
                                <i class="fas fa-shopping-cart iconCss"></i>
                                <p>Cart</p>
                            </div>
                            <!-- <?xml version="1.0" ?><svg viewBox="0 0 256 256" class="iconCsssvg" xmlns="http://www.w3.org/2000/svg"><rect fill="none" height="256" width="256"/><path d="M184,184H69.8L41.9,30.6A8,8,0,0,0,34.1,24H16" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><circle cx="80" cy="204" fill="none" r="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><circle cx="184" cy="204" fill="none" r="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M62.5,144H188.1a15.9,15.9,0,0,0,15.7-13.1L216,64H48" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg> -->
                            <p id="cartItemCount">0</p>
                            
                        </div>
                    </a>
                </li>
                
                <li>
                    <a href="orders.html">
                        <div class="iconColumn">
                            <i class="fas fa-truck iconCss"></i>
                            <p>Orders</p>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="wishlist.html">
                        <div class="iconColumn">
                            <i class="fas fa-heart iconCss"></i>
                            <p>Wish List</p>
                        </div>
                      
                    </a>
                </li>
            </ul>
        </div>
        </div>
         <!--Nab filter bar type-->    
         <div class="navFilterContainer">
            <ul class="filterNav">
                <li class="AllFilterBtn"> 
                    <div style="display: flex;flex-direction: row;align-items: center;">
                    <button id="toggleFilterBtn">
                    <ul id="hum">
                      <li class="hamburger"></li>
                     <li class="hamburger1"></li>
                     <li class="hamburger2"></li>
                    </ul>
                </button>
                <p class="filter-text" style="font-size: 18px;margin-left: 5px;">All</p>
            </div>
            </li>
            <li onclick="CategoryProducts('AC')" data-category="AC" class="filter-text">
                AC                
             </li>
             <li onclick="CategoryProducts('fridzes')" data-category="fridzes" class="filter-text">
                Refrigerator            
             </li>
             <li onclick="CategoryProducts('Sofa')" data-category="Sofa" class="filter-text">
                Sofa              
             </li>
             <li onclick="CategoryProducts('Tables')" data-category="Tables" class="filter-text">
                Tables               
             </li>
             <li onclick="CategoryProducts('Computers')" data-category="Computers" class="filter-text">
                Computers               
             </li>
             <li onclick="CategoryProducts('MobilePhones')" data-category="MobilePhones" class="filter-text">
                Mobiles              
             </li>
             <li onclick="CategoryProducts('BoysFootwear')" data-category="BoysFootwear" class="filter-text">
                BoysFootwear            
             </li>
             <li onclick="CategoryProducts('Televisions')" data-category="Televisions" class="filter-text">
                Televisions           
             </li>
             <li onclick="CategoryProducts('SmartWatches')" data-category="SmartWatches" class="filter-text">
                SmartWatches
             </li>
             <li onclick="CategoryProducts('Cookware')" data-category="Cookware" class="filter-text">
                Cookware            
             </li>
             <li onclick="CategoryProducts('DinnerSets')" data-category="DinnerSets" class="filter-text">
                DinnerSets          
             </li>
             <li onclick="CategoryProducts('MenFootwear')" data-category="MenFootwear" class="filter-text">
                MenFootwear
             </li>
             
            </ul>
        </div>
    </header>

      <!--Filer container side bar-->
      <div class="filterOptions" style="margin-top: -30px;">
        <div style="display: flex;flex-direction: row;justify-content:space-between;">
             <!-- <h2>Search by Brand</h2>  -->
             <div class="filterOptionSearch">
                <input type="text" placeholder="filter by brand...." id="filterSearchInput">
                <a href="#" id="filterSearchIcon"> <i class="fas fa-search iconSearch"></i> </a>
            </div>  
            <button id="closeFilterBtn"><i class="fas fa-times"></i></button>
         </div>       
          <div id="zeptogap">
                <!-- <h1>Category</h1> -->
                <ul id="categoryList">
                    <li onclick="filterCategoryProducts('grocergrocery')" data-category="grocergrocery">
                        <div class="zepto"><img class="zeptoimg" src="https://opensecret.in/cdn/shop/files/Copyof0I6A5830_a0cde61d-5609-43c9-9805-ef9b27dc5199.jpg?v=1682679369&width=990"/>
                            <p>GROCERIES</p>
                        </div>
                     </li>
                     <li onclick="filterCategoryProducts('fashion')" data-category="fashion">
                        <div class="zepto"> 
                            <img class="zeptoimg" src="https://static.vecteezy.com/system/resources/previews/002/295/740/non_2x/beautiful-girl-in-stylish-clothes-fashion-and-style-clothing-and-accessories-vector.jpg" />
                            <p>FASHION</p>
                        </div>
                    </li>
                    <li onclick="filterCategoryProducts('techgadgets')" data-category="techgadgets">
                        <div class="zepto"><img class="zeptoimg" src="https://t4.ftcdn.net/jpg/03/64/41/07/360_F_364410756_Ev3WoDfNyxO9c9n4tYIsU5YBQWAP3UF8.jpg" />
                            <p>ELECTRONICS</p>
                        </div>
                    </li>
                    <li onclick="filterCategoryProducts('HomeFurniture')" data-category="HomeFurniture">
                        <div class="zepto"><img class="zeptoimg" src="https://www.woodenstreet.com/mobile/images-m/furniture-package/classic-package.jpg?v=4" /> 
                            <p>HOME FURNITURE</p>
                        </div>
                    </li>
                    <li onclick="filterCategoryProducts('homeappliances')" data-category="homeappliances">
                     <div class="zepto"><img class="zeptoimg" src="https://images.herzindagi.info/image/2020/Apr/Electronics.jpg" /> 
                            <p>HOME-APPLIANCES</p> 
                        </div>
                    </li>
                     <!-- <div class="zepto"><img class="zeptoimg" src="https://media.istockphoto.com/id/1356594824/photo/playful-little-girl-in-trendy-casual-wear.jpg?s=612x612&w=0&k=20&c=_wMy-M5ysxG_tUxDGLGnFGu15ixuqPdELPgHLmcdESc=" /> <li onclick="filterCategoryProducts('children')" data-category="children">KIDS</li></div> -->
                     <li onclick="filterCategoryProducts('footwear')" data-category="footwear">
                       <div class="zepto"><img class="zeptoimg" src="https://m.media-amazon.com/images/I/51-2tM1l6rL._SX695_.jpg" />
                        <p>Footwear</p>
                        </div>
                    </li>
                    <li onclick="filterCategoryProducts('Cosmetics')" data-category="Cosmetics">
                     <div class="zepto"><img class="zeptoimg" src="https://images-static.nykaa.com/media/catalog/product/4/c/4c337686902395718338_1.jpg?tr=w-344,h-344,cm-pad_resize" /> 
                        <p>Cosmetics</p>
                    </div>
                </li>
                </ul>
         </div>
            
           <div class="ratingBasedFilter">
                <h1>Rating</h1>
                <ul>
                    <div class="zepto">  <li class="rating5"></li></div>
                    <div class="zepto">  <li class="rating4"></li></div>
                    <div class="zepto"> <li class="rating3"></li></div>
                    <div class="zepto"> <li class="rating2"></li></div>
                    <div class="zepto"> <li class="rating1"></li></div>
                </ul>
            </div>
            <button id="clearFilterBtn">Clear Filter</button>
     </div>
     <div class="pageContainer">
        <div class="thanksContainer">
            <div class="procontainer">
                <h1>Thank You!</h1>
                <p>Your order has been placed successfully.</p>
                <button onclick="window.location.href = 'homepage.html';" class="continueShopBtn">Continue to Shop</button>
            </div>
        </div>
    
        <div class="productListContainer">
                <h1 >suggestion for you </h1>
                <div id="productsList" class="itemMainContainer"></div>
        </div> 

       <footer class="greatindia-footer">
        <div class="footer-top">
        <a href="#top" class="back-to-top">Back to top</a>
        </div>
         
        <footer class="footer">
        <div class="footerContainer">
            <div class="row">
                <div class="footer-col">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#">about us</a></li>
                        <li><a href="#">our services</a></li>
                        <li><a href="#">privacypolicy</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>get help</h4>
                    <ul>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">shipping</a></li>
                    <li><a href="#">returns</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>contact us</h4>
                    <ul>
                    <li><a href="#">greatindia@gi.com</a></li>
                    <li><a href="#">9xxxxxxxxx</a></li>
                    </ul>
                </div>
                 <div class="footer-col">
                    <h4>follow us</h4>
                    <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
                </div>
            </div>
        </div>
        </footer>
        </footer>
    </div>

    <script src="common.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const lastOrderedItems = JSON.parse(localStorage.getItem('lastOrderedItems')) || [];
            const subcategories = [...new Set(lastOrderedItems.map(item => 
                (item.subcategoryName || item.subcategory || item.subcategorie || item.categoryNameLower).toLowerCase()
            ))];

        
        // Fetch products from the API
        async function fetchProducts() {
            try {
                const response = await fetch("https://api.npoint.io/27833b79d75e587b7b52");
                return await response.json();
            } catch (error) {
                console.error('Error fetching products:', error);
                throw error;
            }
        }

        const productData = await fetchProducts();

        // Filter and display similar items based on subcategories
        const similarItemsContainer = document.getElementById("productsList");

        if (subcategories.length > 0) {
            let productsFound = false;

            productData.products.forEach(mainCategory => {
                console.log(mainCategory)
              
                mainCategory.categories.forEach(category => {
                    //console.log(category.category)
                    const lowercaseCategory = category.category.toLowerCase();
                    if(subcategories.includes(lowercaseCategory)){
                    category.items.slice(0, 4).forEach(item => {
                        
                            createProductDiv(item, mainCategory.maincategory,category.category);
                            productsFound = true;
                        
                    });
                }
                });
            });

            if (!productsFound) {
                similarItemsContainer.innerHTML = "<p>No similar items found.</p>";
            }
        } else {
            similarItemsContainer.innerHTML = "<p>No subcategories available to fetch similar items.</p>";
        }

            // Function to create and append product div
            function createProductDiv(item, mainCategory,subcategory) {
                const productData = { ...item, mainCategoryName: mainCategory,subcategory };
                const productDataString = JSON.stringify(productData, (key, value) => {
                  // Escape single quotes in string values
                    return typeof value === 'string' ? value.replace(/'/g, "&#39;") : value;
                });
                
                const truncateText = (text, maxLength) => {
                   return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                 };
                 const truncatedName = truncateText(item.name, 15);

                //  const TruncateText = (text, maxLength) => {
                //    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                //  };
                //  const TruncatedName = TuncateText(item.description, 55);
                 
                // Check if product is in favorites
                const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                const isFavorite = favorites.some(items => items.id === item.id);
            
                // Check if product is in cart
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const isInCart = cart.some(items => items.id === item.id);
               // Determine selected size
                let selectedSize = '';
                if (item.size && item.size.length > 0) {
                    selectedSize = item.size[0]; // Default to first size if available
                } else if (item['size(UK)'] && item['size(UK)'].length > 0) {
                    selectedSize = item['size(UK)'][0]; // Default to first UK size if available
                }

                const itemDiv = document.createElement("div");
                itemDiv.classList.add("itemsContainer");
                itemDiv.innerHTML = `
                 <div class='itemsDetails' >
                    <div data-product='${productDataString}' onclick="viewItemDetails(this)">
                    <div id='imgContiner'>
                        <img src="${item.image}" alt="${item.name}" class="itemImg">
                    </div>
                    <div class='itemMatter'>
                        <div class="wishList">
                            <h3>${truncatedName}</h3>
                            <div data-product='${productDataString}' onclick="addToWishlist(event,this)" class="favoriteBtn">
                                <i class="${isFavorite ? 'fas' : 'far'} fa-heart"  title="${isFavorite ? 'Remove from Wishlist' : 'Add to Wishlist'}"></i>
                            </div>
                        </div>
                        ${item.brand ? `<p>Brand: ${item.brand}</p>` : ''}
                        ${item.quantity ? `<p>Quantity: ${item.quantity}</p>` : ''}
                        ${item.rating ? `<p class='rating'> ${item.ratingstars}</p>` : ''}
                        <div class='priceCart'>
                            <div class="prices">
                                <p class="mainprice">&#8377; ${item.mainprice}</p>
                                ${item.discount ? `<p class="discount">${item.discount}</p>` : ''}
                            </div>           
                        </div>
                        </div>
                    </div>
                    </div>
                    <div class='priceCartBtn'>
                        <button type='button' class='addCart' data-product='${productDataString}'  data-size="${selectedSize}" onclick="addToCart(this)">${isInCart ? 'Go to Cart' : 'Add to Cart'}</button>
                    </div>
                </div>
            `;
                similarItemsContainer.appendChild(itemDiv);
            }
        });

         // View item details function
    window.viewItemDetails = function(div) {
        try {
            const productDataString = div.getAttribute('data-product');
            const productData = JSON.parse(productDataString);
            const productId = productData.id;
            const mainCategoryName = productData.mainCategoryName;

            // Store the product data locally
            localStorage.setItem('selectedProductData', JSON.stringify(productData));

            // Redirect to the product detail page with query parameters
            window.location.href = `productDetail.html?productId=${productId}&mainCategoryName=${mainCategoryName}`;
        } catch (error) {
            console.error('Error parsing product data:', error);
        }
    }
     // Function to add item to wishlist
     window.addToWishlist = function(div) {
                try {
                    const productDataString = div.getAttribute('data-product');
                    const productData = JSON.parse(productDataString);
                    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

                    // Check if product is already in favorites
                    const existingIndex = favorites.findIndex(item => item.id === productData.id);

                    if (existingIndex !== -1) {
                        // Remove from favorites
                        favorites.splice(existingIndex, 1);
                        div.querySelector('i').classList.remove('fas');
                        div.querySelector('i').classList.add('far');
                    } else {
                        // Add to favorites
                        favorites.push(productData);
                        div.querySelector('i').classList.remove('far');
                        div.querySelector('i').classList.add('fas');
                    }

                    // Save updated favorites to local storage
                    localStorage.setItem('favorites', JSON.stringify(favorites));
                } catch (error) {
                    console.error('Error adding to wishlist:', error);
                }
            };
    </script>    
    <script src="ProductsList.js"></script>    
</body>
</html>